Practical Clojure
=================
:author  Pavel Tišnovský
:email   <ptisnovs 0x40 redhat 0x2e com>
:date    2017-05-0?

Agenda
------
▶ Clojure - (not) yet another language for JVM
▶ Basic Clojure features
▶ Forms
▶ Collections
▶ Functions
▶ Lazy evaluation and lazy sequences
▶ Four reference types (variable substitution)
▶ Parallel programming
▶ Watchers
▶ Validators
▶ Macros
▶ Classes and objects in Clojure
▶ Cooperation between Java and Clojure
▶ Web apps (Clojure Ring philosophy)
▶ Testing
▶ Code coverage reporting

Clojure - (yet another) language for JVM
----------------------------------------
Java Virtual Machine
Specification implemented by more VMs
    HotSpot
        Client
        Server
    Azul
    J9
    JamVM
    CACAO VM
    Graal
    Jikes RVM

JVM
---
JVM is scalable
    No (apparent) GIL
    Multi-threaded garbage collectors
    Synchronized and unsynchronized variants of collections
    Future interface
and
Supports dynamically typed programming languages

Java platform
-------------
Compiler+JVM+standard packages+other tools
Mature
    evolving since 1985 now > 14M developers (TIOBE)
Stable and robust + rich standard libraries
Usually backward compatible
    "Java is a modern COBOL"

Java is not the only language prepared to run on JVM
-----------------------------------------------------
JavaScript
    Rhino
    Nashorn
Scala
Groovy
Jython
JRuby
Kotlin
...
...
...
Clojure!

Clojure
-------
Clojure = Java + Closure
Rich Hickey
Based on LISP (and on Scheme too)
    Theory of λ-calculus
        Alonzo Church
        Look at the Clojure logo :)
    WEB2.0^W cloud^W social networks^W^W AI was the IT buzzword in 1950s
    John McCarthy 1956-1958
    Implemented by S.R.Russell (REPL)

Java vs.Clojure?
----------------
Clojure is not replacement of Java
    does not try to reinvent the wheel
    cooperates nicely with Java libs
        "Java interop"

Basic Clojure features
----------------------
Deadlock-free multi-threaded programs
    Immutable data types
        List (linked), vector (RRB Tree), hash map, set
        very important feature in massive parallel applications
    Agents
    Software Transactional Memory (STM)
        Support for transactions
Clojure contains REPL
    Read-Eval-Print-Loop
Code == Data
    -> Homoiconicity
    Well, Clojure is a LISP variant...

Basic Clojure features
----------------------
Four reference types instead of simple "variables"
    variables are a poor choice for many operations
    sync/async operations
    atomic operations
    regular variable can't be "watched"
    regular variable can't be validated simply

Basic Clojure features
----------------------
Lambda expressions
Closures
Explicit tail recursion
Clojure is lazy
    ie it is like many humans (incl. /me)
    Performs required work only when forced/asked
    Lazy sequences
        range function is a good example
    Some work (computation) does not have to be performed ASAP
        Let's start it in a background thread!

Java <--> Clojure communication
-------------------------------
Clojure can create an instance of a Java class and access its attributes and methods
    JSR-292 support
Programs are compiled into JVM bytecode
    On the fly
        The best of "scripted" and "compiled" worlds :-)
    With support for dynamic typing 
        Not an easy task (before invokedynamic)

Namespaces
----------
namespace/name
ns macro
no real "global" variables

Forms
-----
Literals
    Numbers
    Strings
    Boolean values
    Symbols and keywords
Compound forms
    Lists
    Vectors
    Maps
    Sets

Special forms
-------------
Special forms
    if
    def
        creates a "global" var with the given name
    do
    new
        calls the respective constructor of the given Java class
    . (dot)
        used to call methods of Java objects
    etc.

Function calls
--------------

Nested functions
----------------

Collections
-----------
List, Vector, Map, Set
Immutable items
Persistent collections
    It's not neccessary to clone a collection in case of some operations
    pop/peek for lists
    ...

Lists
------
Lists
    Internally constist of:
        first item
        rest (sublist)
        count
Program itself is represented by a sequence of lists!

Vectors
-------
Vectors
    used extensivelly in Clojure
    Based on RRB-Trees, Relaxed Radix Balanced Trees
    usually takes less memory than lists
        <=32 items -> simple array
        <=1024 items -> tree with height=2
            root=32 references to 32-item vectors
        <= 32768 items -> tree with height=3
            and so on...

Functions
---------

Lazy evaluation and lazy sequences
----------------------------------

Four reference types (variable substitution)
--------------------------------------------

Parallel programming
--------------------

Watchers
--------

Validators
----------

Macros
------

Classes and objects in Clojure
------------------------------

Cooperation between Java and Clojure
------------------------------------

Web apps (Clojure Ring philosophy)
----------------------------------

Testing
-------

Code coverage reporting
-----------------------

